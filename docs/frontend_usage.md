# 前端界面使用说明 - 文档清理功能

## 📱 界面概览

系统现在有**两个地方**可以触发文档清理功能：

### 1. 📊 仪表板 - 快速操作区
在主仪表板页面的"快速操作"区域，有4个快捷按钮：

```
⚡ 快速操作
┌──────────────┬──────────────┬──────────────┬──────────────┐
│ 🚀 批量处理  │ 🔄 清理版本  │ 🗑️ 清理过期  │ ⚙️ 系统设置  │
│   文档       │   重复       │   文档       │             │
└──────────────┴──────────────┴──────────────┴──────────────┘
```

- **🚀 批量处理文档**: 批量处理待处理的文档（默认20个）
- **🔄 清理版本重复**: 快速清理总行发文版本重复（默认50个）
- **🗑️ 清理过期文档**: 快速清理过期文档（默认50个）
- **⚙️ 系统设置**: 跳转到系统设置页面

### 2. 🛠️ 系统维护页面 - 详细控制
专门的维护管理页面，提供更详细的控制和监控功能。

---

## 🛠️ 系统维护页面详解

### 页面结构

维护页面包含3个标签页：

```
🛠️ 系统维护管理
├── 📋 版本去重
├── 🗑️ 过期清理
└── 📊 任务监控
```

---

### 📋 版本去重标签页

#### 功能说明区
显示详细的功能介绍：
- ✅ 检测文档名中的修订关键词
- ✅ 提取标题进行模糊匹配
- ✅ 使用AI分析版本号
- ✅ 删除旧版本文档

#### 当前设置
- **定时任务**: 每天凌晨2点自动执行
- **默认处理**: 50个文档/次
- **修订关键词列表**: 修订、修改、更新、调整、变更、修正、补充、完善、废止、废除

#### 手动触发控制
1. **处理文档数量滑块** (10-200)
   - 可以精确控制一次处理多少文档
   - 建议从小数量开始测试

2. **预览模式复选框** (暂未实现)
   - 勾选后不会实际删除，只显示会删除的文档
   - 用于测试和验证

3. **🚀 开始清理按钮**
   - 点击后提交清理任务
   - 显示任务ID和提交状态

#### 使用示例
```
1. 调整"处理文档数量"滑块到 30
2. 点击"🚀 开始清理"按钮
3. 看到成功提示和任务ID
4. 切换到"📊 任务监控"标签页查看进度
```

---

### 🗑️ 过期清理标签页

#### 功能说明区
显示详细的功能介绍：
- ✅ 检查ai_metadata中的有效期字段
- ✅ 对比当前日期判断过期
- ✅ 没有元数据时使用AI判断
- ✅ 删除过期文档

#### 当前设置
- **定时任务**: 每周日凌晨3点自动执行（每7天一次）
- **默认处理**: 50个文档/次
- **永久有效标识**: 永久、无、permanent、none、never、长期

#### 手动触发控制
与版本去重页面类似，提供：
1. 处理文档数量滑块 (10-200)
2. 预览模式复选框
3. 开始清理按钮

---

### 📊 任务监控标签页

#### 功能概览
实时监控清理任务的执行状态和结果。

#### 页面按钮
- **🔄 刷新状态**: 刷新所有任务的最新状态
- **🗑️ 清空历史**: 清空任务历史记录

#### 任务卡片

每个任务显示一个可展开的卡片：

```
🔄 版本去重 - abc123def456...  [展开/收起]
├── 任务ID: abc123def456789...
├── 任务类型: 🔄 版本去重
├── 处理数量: 50 个文档
├── 开始时间: 2025-01-15 10:30:00
├── 状态: ✅ 执行成功
└── 📈 执行结果
    ├── 处理文档: 50
    ├── 发现重复: 5
    ├── 删除文档: 8
    └── 错误数: 0
```

#### 任务状态标识
- ⏳ **等待执行**: 任务已提交但未开始
- 🔄 **执行中**: 任务正在执行
- ✅ **执行成功**: 任务成功完成
- ❌ **执行失败**: 任务执行失败

#### 执行结果展示

**版本去重任务结果**:
- 处理文档数
- 发现重复组数
- 删除文档数
- 错误数
- 详细信息（标题、最新版本、删除数量、判断理由）

**过期清理任务结果**:
- 处理文档数
- 元数据判定过期数
- AI判定过期数
- 错误数
- 详细信息（文件名、检查方式、过期日期、判断理由）

---

## 🎯 使用场景

### 场景1: 日常快速清理
在仪表板页面，使用快速操作按钮：

1. 打开系统，进入"📊 仪表板"
2. 在"⚡ 快速操作"区域
3. 点击"🔄 清理版本重复"或"🗑️ 清理过期文档"
4. 看到成功提示即可

**优点**: 快速便捷，适合日常维护
**缺点**: 无法自定义参数，使用默认设置

---

### 场景2: 精确控制清理
在系统维护页面，自定义参数：

1. 打开系统，切换到"🛠️ 系统维护"
2. 选择对应的标签页（版本去重/过期清理）
3. 调整"处理文档数量"滑块
4. 点击"🚀 开始清理"按钮
5. 切换到"📊 任务监控"标签页
6. 实时查看执行进度和结果

**优点**: 可控性强，可查看详细结果
**缺点**: 操作步骤稍多

---

### 场景3: 测试验证
在生产环境使用前先测试：

1. 进入"🛠️ 系统维护"页面
2. 将"处理文档数量"设为 10
3. 勾选"预览模式"（如果可用）
4. 点击"🚀 开始清理"
5. 在"📊 任务监控"查看会删除哪些文档
6. 验证无误后，取消预览模式，增大处理数量

**优点**: 安全可靠，先验证后执行
**注意**: 预览模式功能待实现

---

### 场景4: 紧急大量清理
发现大量重复或过期文档需要紧急清理：

1. 进入"🛠️ 系统维护"页面
2. 将"处理文档数量"调到最大 200
3. 点击"🚀 开始清理"
4. 在"📊 任务监控"监控进度
5. 如有需要，可以多次执行直到清理完成

**提示**: 建议分批次执行，避免一次性处理过多

---

## 📱 界面截图说明

### 仪表板快速操作
```
┌─────────────────────────────────────────────────────┐
│  ⚡ 快速操作                                         │
├─────────────────────────────────────────────────────┤
│  ┌────────┐  ┌────────┐  ┌────────┐  ┌────────┐   │
│  │   🚀   │  │   🔄   │  │   🗑️   │  │   ⚙️   │   │
│  │ 批量   │  │ 清理   │  │ 清理   │  │ 系统   │   │
│  │ 处理   │  │ 版本   │  │ 过期   │  │ 设置   │   │
│  │ 文档   │  │ 重复   │  │ 文档   │  │        │   │
│  └────────┘  └────────┘  └────────┘  └────────┘   │
└─────────────────────────────────────────────────────┘
```

### 系统维护页面
```
┌─────────────────────────────────────────────────────┐
│  🛠️ 系统维护管理                                    │
├─────────────────────────────────────────────────────┤
│  ┌──────────┬──────────┬──────────┐               │
│  │ 📋 版本  │ 🗑️ 过期  │ 📊 任务  │               │
│  │   去重   │   清理   │   监控   │               │
│  └──────────┴──────────┴──────────┘               │
│                                                     │
│  功能说明                                           │
│  ┌─────────────────────────────────────────────┐  │
│  │ 1. 检测修订关键词                             │  │
│  │ 2. 提取标题匹配                               │  │
│  │ 3. AI分析版本号                               │  │
│  │ 4. 删除旧版本                                 │  │
│  └─────────────────────────────────────────────┘  │
│                                                     │
│  ⚡ 手动触发                                        │
│  处理文档数量: [====●========] 50                  │
│  □ 预览模式                                        │
│  [    🚀 开始清理    ]                             │
└─────────────────────────────────────────────────────┘
```

---

## 💡 使用技巧

### 1. 从小到大
首次使用建议：
- 先处理10-20个文档测试
- 观察结果是否符合预期
- 再逐步增加处理数量

### 2. 定期维护
建议维护频率：
- **版本去重**: 每周一次（定时任务已设置为每天凌晨2点自动执行）
- **过期清理**: 每周一次（定时任务已设置为每周日凌晨3点自动执行）

### 3. 监控结果
每次清理后：
- 查看"错误数"是否为0
- 查看详细信息确认删除正确
- 检查日志文件了解详情

### 4. 备份数据
重要提醒：
- 删除操作不可逆
- 建议先在测试环境验证
- 生产环境定期备份数据

---

## ⚠️ 注意事项

### 1. 删除操作不可逆
- 一旦删除无法恢复
- 请谨慎使用
- 建议先小批量测试

### 2. AI判断可能有误
- AI分析不是100%准确
- 建议查看详细结果
- 发现问题及时反馈

### 3. 并发限制
- 避免同时运行多个相同任务
- 等待上一个任务完成再提交新任务

### 4. 性能影响
- 大量文档处理需要时间
- 建议在系统空闲时执行
- 避免影响正常业务

---

## 🔧 故障排查

### 问题1: 点击按钮没反应
**原因**: 后端服务未运行或网络问题
**解决**:
1. 检查后端服务是否启动
2. 查看浏览器控制台错误
3. 检查网络连接

### 问题2: 任务一直显示"执行中"
**原因**: Worker未运行或处理缓慢
**解决**:
1. 检查Celery worker状态
2. 查看worker日志
3. 等待更长时间或重启worker

### 问题3: 提示"API调用失败"
**原因**: API地址配置错误
**解决**:
1. 检查utils/api_config.py配置
2. 确认后端服务地址正确
3. 测试API连接性

---

## 📞 获取帮助

如遇到问题：
1. 查看系统日志
2. 检查API文档: http://localhost:8000/docs
3. 联系开发团队

---

## 更新日志

**2025-01-15**
- ✅ 在仪表板添加快速操作按钮
- ✅ 新增系统维护专门页面
- ✅ 添加任务监控功能
- ✅ 支持自定义处理数量
- ⏳ 预览模式待实现
